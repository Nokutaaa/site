<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Vidéos flottantes avec logo central & background</title>
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100%;
    overflow: hidden;
    background: #111;
    font-family: Arial, sans-serif;
  }
  body {
    position: relative;
  }

  /* Vidéo de fond en full screen, derrière tout */
  #bg-video {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    object-fit: cover;
    filter: brightness(0.5);
    z-index: -1000;
  }

  #logo {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10000;
    pointer-events: none;
    user-select: none;
    width: 300px;
    height: 300px;
    background: url('logo1.png') no-repeat center center;
    background-size: contain;
  }

  .floating-video {
    position: absolute;
    border-radius: 10px;
    filter: blur(1.3px);
    opacity: 0.75;
    cursor: pointer;
    object-fit: cover;
    transition: filter 0.3s ease, opacity 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    z-index: 1;
  }

  .floating-video:hover {
    filter: none;
    opacity: 1;
    box-shadow: 0 0 25px rgba(255,255,255,0.9);
    z-index: 1000;
  }

  .floating-video.selected {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    width: 80vw !important;
    height: auto !important;
    max-height: 80vh !important;
    opacity: 1 !important;
    filter: none !important;
    box-shadow: 0 0 35px rgba(255,255,255,1) !important;
    z-index: 10001 !important;
    cursor: default !important;
  }
</style>
</head>
<body>

<video id="bg-video" autoplay muted loop playsinline>
  <source src="fond.mp4" type="video/mp4" />
  Votre navigateur ne supporte pas la vidéo HTML5.
</video>

<div id="logo"></div>

<script>
  const videosSrc = [
    'video1.mp4',
    'video2.mp4',
    'video3.mp4',
    'video4.mp4',
    'video5.mp4',
    'video6.mp4'
  ];

  const floatingVideos = [];
  const containerWidth = window.innerWidth;
  const containerHeight = window.innerHeight;

  const logo = document.getElementById('logo');
  let logoRect;

  function updateLogoRect() {
    logoRect = logo.getBoundingClientRect();
  }
  updateLogoRect();
  window.addEventListener('resize', () => {
    updateLogoRect();
  });

  function isOverlap(rect1, rect2) {
    return !(rect1.right < rect2.left ||
             rect1.left > rect2.right ||
             rect1.bottom < rect2.top ||
             rect1.top > rect2.bottom);
  }

  function canPlace(x, y, width, height) {
    const newRect = {
      left: x,
      top: y,
      right: x + width,
      bottom: y + height
    };
    // Check logo
    if (isOverlap(newRect, logoRect)) return false;

    // Check already placed videos
    for(const v of floatingVideos) {
      const r = v.rect;
      if (isOverlap(newRect, r)) return false;
    }
    return true;
  }

  // Positionne les vidéos aléatoirement dans une zone plus large, pour bien couvrir l’écran
  // on tente un placement avec 1500 essais max pour éviter boucle infinie
  function findPosition(width, height) {
    const maxAttempts = 1500;
    for(let i=0; i<maxAttempts; i++) {
      // Zone un peu réduite par rapport au viewport pour éviter que vidéos soient collées au bord
      const x = Math.random() * (containerWidth - width - 40) + 20;
      const y = Math.random() * (containerHeight - height - 40) + 20;
      if(canPlace(x, y, width, height)) return {x, y};
    }
    // fallback si placement impossible
    return {x: 20, y: 20};
  }

  function createFloatingVideo(src) {
    const video = document.createElement('video');
    video.src = src;
    video.muted = true;
    video.loop = true;
    video.autoplay = true;
    video.playsInline = true;
    video.preload = 'auto';
    video.classList.add('floating-video');

    // Largeur entre 200 et 350 px, ratio 16:9
    const width = 200 + Math.random() * 150;
    const height = width * 9 / 16;
    video.style.width = width + 'px';
    video.style.height = height + 'px';

    const pos = findPosition(width, height);
    video.style.left = pos.x + 'px';
    video.style.top = pos.y + 'px';

    floatingVideos.push({
      video,
      rect: {left: pos.x, top: pos.y, right: pos.x + width, bottom: pos.y + height},
      baseLeft: pos.x,
      baseTop: pos.y,
      width,
      height
    });

    video.addEventListener('click', (e) => {
      e.stopPropagation();
      if(video.classList.contains('selected')) {
        deselectAll();
      } else {
        selectVideo(video);
      }
    });

    document.body.appendChild(video);
  }

  function selectVideo(selectedVideo) {
    floatingVideos.forEach(({video}) => {
      if(video === selectedVideo){
        video.classList.add('selected');
        video.controls = true;
        video.muted = false;
        video.play();
        video.style.zIndex = '10001';
      } else {
        video.style.filter = 'blur(2px)';
        video.style.opacity = '0.5';
        video.style.pointerEvents = 'none';
        video.controls = false;
      }
    });
  }

  function deselectAll() {
    floatingVideos.forEach(({video}) => {
      video.classList.remove('selected');
      video.style.filter = 'blur(1.3px)';
      video.style.opacity = '0.75';
      video.style.pointerEvents = 'auto';
      video.controls = false;
      video.muted = true;
      video.play();
      video.style.zIndex = '1';
    });
  }

  // Création des 6 vidéos uniquement
  videosSrc.forEach(src => createFloatingVideo(src));

  // Flottement plus ample et fluide
  function animate(time=0) {
    floatingVideos.forEach(({video, baseLeft, baseTop}, i) => {
      if(!video.classList.contains('selected')) {
        // Oscillation plus grande, sans lag
        const offsetX = 10 * Math.sin(time / 900 + i * 1.3);
        const offsetY = 7 * Math.cos(time / 1100 + i * 1.7);
        video.style.left = (baseLeft + offsetX) + 'px';
        video.style.top = (baseTop + offsetY) + 'px';
      }
    });
    requestAnimationFrame(animate);
  }
  animate();

  document.body.addEventListener('click', () => {
    deselectAll();
  });

  // Au resize on reload pour recalculer positions (évite chevauchements)
  window.addEventListener('resize', () => {
    location.reload();
  });
</script>

</body>
</html>

