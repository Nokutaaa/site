<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Nokuta - Vidéos flottantes</title>
<link rel="icon" href="favicon.jpg" type="image/jpg" />
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    overflow: hidden;
    font-family: 'Poppins', sans-serif;
    background: #000;
  }

  #bg-video {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -10;
    filter: brightness(0.5);
  }

  #logo {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200px;  /* double taille */
    height: auto;
    z-index: 10000;
    pointer-events: none;
  }

  #video-container {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    pointer-events: none; /* pour que flottantes soient cliquables */
    z-index: 5000;
  }

  .floating-video {
    position: absolute;
    border-radius: 12px;
    filter: blur(1.5px);
    opacity: 0.75;
    cursor: pointer;
    pointer-events: auto;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    transition: filter 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
    user-select: none;
    will-change: transform, filter, opacity;
  }

  .floating-video:hover {
    filter: blur(0);
    opacity: 1;
    box-shadow: 0 0 25px rgba(255,255,255,0.8);
    z-index: 9000;
  }

  .selected-video-overlay {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80vw;
    max-width: 1200px;
    max-height: 80vh;
    border-radius: 14px;
    box-shadow: 0 0 30px rgba(0,0,0,0.9);
    z-index: 15000;
    background: #000;
  }

  .selected-video-overlay video {
    width: 100%;
    height: 100%;
    border-radius: 14px;
    object-fit: contain;
  }

  /* Bouton fermer */
  #close-btn {
    position: fixed;
    top: 25px;
    right: 25px;
    background: rgba(255,255,255,0.9);
    border: none;
    border-radius: 30px;
    width: 40px;
    height: 40px;
    font-size: 24px;
    cursor: pointer;
    z-index: 16000;
    box-shadow: 0 0 8px rgba(0,0,0,0.5);
    transition: background 0.3s ease;
  }

  #close-btn:hover {
    background: rgba(255,255,255,1);
  }
</style>
</head>
<body>

<video autoplay muted loop playsinline id="bg-video" preload="auto">
  <source src="fond.mp4" type="video/mp4" />
  Votre navigateur ne supporte pas la vidéo HTML5.
</video>

<img src="logo1.png" id="logo" alt="Logo Nokuta" />

<div id="video-container"></div>

<script>
  const videosSrc = [
    "video1.mp4",
    "video2.mp4",
    "video3.mp4",
    "video4.mp4",
    "video5.mp4",
    "video6.mp4"
  ];

  const container = document.getElementById('video-container');
  const logo = document.getElementById('logo');

  // Paramètres
  const videoCount = videosSrc.length;
  const minDistance = 25; // px minimal entre vidéos et logo
  const floatingRange = 15; // px de déplacement flottant max
  const floatingSpeed = 0.0035; // vitesse flottement
  const baseMinSize = 220; // min width
  const baseMaxSize = 320; // max width

  let floatingVideos = [];

  // Fonction pour calculer distance entre deux rectangles (simplifié à distance centre)
  function distance(rect1, rect2){
    const x1 = rect1.left + rect1.width/2;
    const y1 = rect1.top + rect1.height/2;
    const x2 = rect2.left + rect2.width/2;
    const y2 = rect2.top + rect2.height/2;
    return Math.hypot(x1 - x2, y1 - y2);
  }

  // Fonction pour vérifier recouvrement (distance plus que minDistance)
  function isTooClose(newRect, others){
    for(const other of others){
      if(distance(newRect, other) < minDistance) return true;
    }
    // Vérif avec logo aussi
    const logoRect = logo.getBoundingClientRect();
    if(distance(newRect, logoRect) < minDistance) return true;
    return false;
  }

  // Générer position aléatoire et taille pour une vidéo, en évitant recouvrement
  function generatePositionAndSize(existingRects) {
    const vw = window.innerWidth;
    const vh = window.innerHeight;

    let tries = 0;
    while(tries < 1000){
      const width = baseMinSize + Math.random() * (baseMaxSize - baseMinSize);
      const height = width * 9/16; // ratio 16:9
      const left = Math.random() * (vw - width);
      const top = Math.random() * (vh - height);

      const rect = {left, top, width, height};
      if(!isTooClose(rect, existingRects)){
        return rect;
      }
      tries++;
    }
    // fallback : place sans vérif
    return {left: 50, top: 50, width: baseMinSize, height: baseMinSize*9/16};
  }

  // Création des vidéos flottantes
  function createFloatingVideos(){
    const existingRects = [];
    floatingVideos = [];

    for(let i=0; i < videoCount; i++){
      const rect = generatePositionAndSize(existingRects);
      existingRects.push(rect);

      const vid = document.createElement('video');
      vid.src = videosSrc[i];
      vid.autoplay = true;
      vid.loop = true;
      vid.muted = true;
      vid.playsInline = true;
      vid.preload = 'auto';
      vid.classList.add('floating-video');
      vid.style.width = rect.width + 'px';
      vid.style.height = rect.height + 'px';
      vid.style.left = rect.left + 'px';
      vid.style.top = rect.top + 'px';

      container.appendChild(vid);

      floatingVideos.push({
        video: vid,
        baseLeft: rect.left,
        baseTop: rect.top,
        size: {width: rect.width, height: rect.height},
        phaseX: Math.random() * 2 * Math.PI,
        phaseY: Math.random() * 2 * Math.PI,
        speedX: floatingSpeed * (0.5 + Math.random()),
        speedY: floatingSpeed * (0.5 + Math.random()),
      });

      // Click pour agrandir la vidéo
      vid.addEventListener('click', () => selectVideo(vid));
    }
  }

  // Afficher la vidéo sélectionnée en grand
  function selectVideo(selectedVideo){
    // Créer overlay
    if(document.querySelector('.selected-video-overlay')) return; // ignore si déjà ouverte

    const overlay = document.createElement('div');
    overlay.classList.add('selected-video-overlay');

    const bigVideo = document.createElement('video');
    bigVideo.src = selectedVideo.src;
    bigVideo.controls = true;
    bigVideo.autoplay = true;
    bigVideo.muted = false;
    bigVideo.currentTime = 0;
    bigVideo.volume = 0.35;
    bigVideo.playsInline = true;
    overlay.appendChild(bigVideo);

    const closeBtn = document.createElement('button');
    closeBtn.id = 'close-btn';
    closeBtn.innerHTML = '&times;';
    closeBtn.title = 'Fermer la vidéo';
    document.body.appendChild(closeBtn);

    document.body.appendChild(overlay);

    // Mettre les autres vidéos en flou + opacité réduite + pointer-events none sauf celle sélectionnée
    floatingVideos.forEach(({video}) => {
      if(video === selectedVideo){
        video.style.filter = 'none';
        video.style.opacity = '1';
        video.style.pointerEvents = 'none';
      } else {
        video.style.filter = 'blur(3px)';
        video.style.opacity = '0.3';
        video.style.pointerEvents = 'none';
      }
    });

    // Bloquer interaction du container (mais pas de l’overlay)
    container.style.pointerEvents = 'none';

    closeBtn.addEventListener('click', () => {
      // Supprimer overlay et bouton
      overlay.remove();
      closeBtn.remove();

      // Rétablir vidéos flottantes
      floatingVideos.forEach(({video}) => {
        video.style.filter = 'blur(1.5px)';
        video.style.opacity = '0.75';
        video.style.pointerEvents = 'auto';
      });

      container.style.pointerEvents = 'auto';
    });
  }

  // Animation flottement
  function animate(time=0){
    floatingVideos.forEach(obj => {
      const {video, baseLeft, baseTop, size, phaseX, phaseY, speedX, speedY} = obj;
      const dx = floatingRange * Math.sin(time * speedX + phaseX);
      const dy = floatingRange * Math.cos(time * speedY + phaseY);

      video.style.transform = `translate(${dx}px, ${dy}px)`;
    });
    requestAnimationFrame(animate);
  }

  // Initialisation
  createFloatingVideos();
  animate();

  // Ajuster les vidéos au redimensionnement (pour éviter qu’elles ne sortent trop)
  window.addEventListener('resize', () => {
    // Clear container and recreate to reposition videos
    container.innerHTML = '';
    createFloatingVideos();
  });
</script>

</body>
</html>
