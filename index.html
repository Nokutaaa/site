<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Nokuta - Vidéos flottantes sans superposition</title>
<link rel="icon" href="favicon.jpg" type="image/jpg" />
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    overflow: hidden;
    font-family: 'Poppins', sans-serif;
    background: #000;
  }

  #bg-video {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -10;
    filter: brightness(0.5);
  }

  #logo {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200px;  /* double taille */
    height: auto;
    z-index: 10000;
    pointer-events: none;
  }

  #video-container {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    pointer-events: none;
    z-index: 5000;
  }

  .floating-video {
    position: absolute;
    border-radius: 12px;
    filter: blur(1.5px);
    opacity: 0.75;
    cursor: pointer;
    pointer-events: auto;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    transition: filter 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
    user-select: none;
    will-change: transform, filter, opacity;
  }

  .floating-video:hover {
    filter: blur(0);
    opacity: 1;
    box-shadow: 0 0 25px rgba(255,255,255,0.8);
    z-index: 9000;
  }

  .selected-video-overlay {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80vw;
    max-width: 1200px;
    max-height: 80vh;
    border-radius: 14px;
    box-shadow: 0 0 30px rgba(0,0,0,0.9);
    z-index: 15000;
    background: #000;
  }

  .selected-video-overlay video {
    width: 100%;
    height: 100%;
    border-radius: 14px;
    object-fit: contain;
  }

  #close-btn {
    position: fixed;
    top: 25px;
    right: 25px;
    background: rgba(255,255,255,0.9);
    border: none;
    border-radius: 30px;
    width: 40px;
    height: 40px;
    font-size: 24px;
    cursor: pointer;
    z-index: 16000;
    box-shadow: 0 0 8px rgba(0,0,0,0.5);
    transition: background 0.3s ease;
  }

  #close-btn:hover {
    background: rgba(255,255,255,1);
  }
</style>
</head>
<body>

<video autoplay muted loop playsinline id="bg-video" preload="auto">
  <source src="fond.mp4" type="video/mp4" />
  Votre navigateur ne supporte pas la vidéo HTML5.
</video>

<img src="logo1.png" id="logo" alt="Logo Nokuta" />

<div id="video-container"></div>

<script>
  const videosSrc = [
    "video1.mp4",
    "video2.mp4",
    "video3.mp4",
    "video4.mp4",
    "video5.mp4",
    "video6.mp4"
  ];

  const container = document.getElementById('video-container');
  const logo = document.getElementById('logo');

  const minDistance = 25; // px margin around videos and logo
  const floatingRange = 15; 
  const floatingSpeed = 0.0035;
  const baseMinSize = 220;
  const baseMaxSize = 320;

  let floatingVideos = [];

  // Fonction pour vérifier chevauchement rectangulaire avec marge
  function isOverlapping(rectA, rectB, margin=0) {
    return !(
      rectA.left + rectA.width + margin < rectB.left ||
      rectA.left > rectB.left + rectB.width + margin ||
      rectA.top + rectA.height + margin < rectB.top ||
      rectA.top > rectB.top + rectB.height + margin
    );
  }

  // Vérifier que rect ne chevauche aucun dans la liste + logo
  function isTooClose(newRect, others) {
    // Logo rectangle
    const logoRect = logo.getBoundingClientRect();

    // Vérif avec logo
    if(isOverlapping(newRect, logoRect, minDistance)) return true;

    // Vérif avec autres vidéos
    for(const other of others){
      if(isOverlapping(newRect, other, minDistance)) return true;
    }
    return false;
  }

  // Générer position aléatoire sans chevauchement
  function generatePositionAndSize(existingRects) {
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    let tries = 0;

    while(tries < 2000){
      const width = baseMinSize + Math.random() * (baseMaxSize - baseMinSize);
      const height = width * 9/16;
      const left = Math.random() * (vw - width);
      const top = Math.random() * (vh - height);

      const rect = {left, top, width, height};
      if(!isTooClose(rect, existingRects)){
        return rect;
      }
      tries++;
    }

    // Fallback si pas trouvé après essais
    return {left: 50, top: 50, width: baseMinSize, height: baseMinSize*9/16};
  }

  function createFloatingVideos(){
    const existingRects = [];
    floatingVideos = [];
    container.innerHTML = '';

    for(let i=0; i < videosSrc.length; i++){
      const rect = generatePositionAndSize(existingRects);
      existingRects.push(rect);

      const vid = document.createElement('video');
      vid.src = videosSrc[i];
      vid.autoplay = true;
      vid.loop = true;
      vid.muted = true;
      vid.playsInline = true;
      vid.preload = 'auto';
      vid.classList.add('floating-video');
      vid.style.width = rect.width + 'px';
      vid.style.height = rect.height + 'px';
      vid.style.left = rect.left + 'px';
      vid.style.top = rect.top + 'px';

      container.appendChild(vid);

      floatingVideos.push({
        video: vid,
        baseLeft: rect.left,
        baseTop: rect.top,
        size: {width: rect.width, height: rect.height},
        phaseX: Math.random() * 2 * Math.PI,
        phaseY: Math.random() * 2 * Math.PI,
        speedX: floatingSpeed * (0.5 + Math.random()),
        speedY: floatingSpeed * (0.5 + Math.random()),
      });

      vid.addEventListener('click', () => selectVideo(vid));
    }
  }

  function selectVideo(selectedVideo){
    if(document.querySelector('.selected-video-overlay')) return;

    const overlay = document.createElement('div');
    overlay.classList.add('selected-video-overlay');

    const bigVideo = document.createElement('video');
    bigVideo.src = selectedVideo.src;
    bigVideo.controls = true;
    bigVideo.autoplay = true;
    bigVideo.muted = false;
    bigVideo.currentTime = 0;
    bigVideo.volume = 0.35;
    bigVideo.playsInline = true;
    overlay.appendChild(bigVideo);

    const closeBtn = document.createElement('button');
    closeBtn.id = 'close-btn';
    closeBtn.innerHTML = '&times;';
    closeBtn.title = 'Fermer la vidéo';
    document.body.appendChild(closeBtn);

    document.body.appendChild(overlay);

    floatingVideos.forEach(({video}) => {
      if(video === selectedVideo){
        video.style.filter = 'none';
        video.style.opacity = '1';
        video.style.pointerEvents = 'none';
      } else {
        video.style.filter = 'blur(3px)';
        video.style.opacity = '0.3';
        video.style.pointerEvents = 'none';
      }
    });

    container.style.pointerEvents = 'none';

    closeBtn.addEventListener('click', () => {
      overlay.remove();
      closeBtn.remove();

      floatingVideos.forEach(({video}) => {
        video.style.filter = 'blur(1.5px)';
        video.style.opacity = '0.75';
        video.style.pointerEvents = 'auto';
      });

      container.style.pointerEvents = 'auto';
    });
  }

  function animate(time=0){
    floatingVideos.forEach(obj => {
      const {video, baseLeft, baseTop, speedX, speedY, phaseX, phaseY} = obj;
      const dx = floatingRange * Math.sin(time * speedX + phaseX);
      const dy = floatingRange * Math.cos(time * speedY + phaseY);

      video.style.transform = `translate(${dx}px, ${dy}px)`;
    });
    requestAnimationFrame(animate);
  }

  createFloatingVideos();
  animate();

  window.addEventListener('resize', () => {
    createFloatingVideos();
  });

</script>

</body>
</html>
