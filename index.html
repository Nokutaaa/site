<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Nokuta - Vidéos défilantes</title>
<link rel="icon" href="favicon.jpg" type="image/jpg" />
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100%;
    overflow-x: hidden;
    font-family: 'Poppins', sans-serif;
    background: black;
    position: relative;
  }

  #bg-video {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    object-fit: cover;
    z-index: -10;
    filter: brightness(0.5);
  }

  header {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    width: 100%;
    text-align: center;
  }

  .logo {
    height: 60px;
    user-select: none;
  }

  .floating-video {
    position: absolute;
    opacity: 0.6;
    filter: blur(1.8px);
    border-radius: 8px;
    object-fit: cover;
    cursor: pointer;
    transition: opacity 0.3s ease, filter 0.3s ease, box-shadow 0.3s ease;
    pointer-events: auto;
    will-change: transform;
  }

  .floating-video:hover {
    opacity: 0.95;
    filter: blur(0.5px);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
    z-index: 10001;
  }

  /* Animation moved to JS for better control */
</style>
</head>
<body>

<header>
  <img src="logo1.png" alt="Logo" class="logo" />
</header>

<video autoplay muted loop playsinline id="bg-video">
  <source src="fond.mp4" type="video/mp4" />
  Votre navigateur ne supporte pas la vidéo HTML5.
</video>

<script>
  const videosSrc = ["video1.mp4", "video2.mp4", "video3.mp4", "video4.mp4", "video5.mp4", "video6.mp4"];
  const maxVideosOnScreen = 10;

  const containerHeight = window.innerHeight;
  const containerWidth = window.innerWidth;

  const usedTops = [];
  const floatingVideos = [];

  // Trouver une position verticale sans superposition
  function findFreeTop(height) {
    const step = 40; // minimum spacing
    for (let top = 60; top < containerHeight - height - 60; top += step) {
      let conflict = false;
      for (const used of usedTops) {
        if (Math.abs(used - top) < step) {
          conflict = true;
          break;
        }
      }
      if (!conflict) {
        usedTops.push(top);
        return top;
      }
    }
    // fallback
    return Math.random() * (containerHeight - height - 100) + 50;
  }

  // Générer une position horizontale initiale aléatoire dans la fenêtre (pour effet boucle déjà commencée)
  function getRandomStartX(width) {
    return Math.random() * (containerWidth + 400) - width - 200;
  }

  // Création d'une vidéo flottante
  function createFloatingVideo(src) {
    const video = document.createElement('video');
    video.src = src;
    video.muted = true;
    video.loop = true;
    video.autoplay = true;
    video.playsInline = true;
    video.preload = 'auto';
    video.className = 'floating-video';

    // taille aléatoire 150-300 px largeur, ratio 16:9
    const width = 150 + Math.random() * 150;
    const height = width * 9 / 16;

    video.style.width = `${width}px`;
    video.style.height = `${height}px`;

    const top = findFreeTop(height);
    video.style.top = `${top}px`;

    // Position horizontale aléatoire pour démarrer sur toute la largeur + marge hors écran
    video.style.left = `${getRandomStartX(width)}px`;

    // Stocke les infos de vitesse et position pour animation manuelle
    const speed = 10 + Math.random() * 15; // pixels / seconde

    floatingVideos.push({video, top, width, height, speed, x: parseFloat(video.style.left)});

    video.addEventListener('click', () => {
      if(video.classList.contains('selected')) {
        deselectVideo();
      } else {
        selectVideo(video);
      }
    });

    document.body.appendChild(video);
  }

  // Sélection vidéo au centre
  function selectVideo(video) {
    // Bloquer animation autres vidéos (garder léger flottement)
    floatingVideos.forEach(({video: v}) => {
      if (v !== video) {
        v.style.opacity = '0.3';
        v.style.filter = 'blur(1px)';
      }
    });

    // Styles vidéo sélectionnée
    video.classList.add('selected');
    video.style.position = 'fixed';
    video.style.top = '50%';
    video.style.left = '50%';
    video.style.transform = 'translate(-50%, -50%) scale(1.5)';
    video.style.zIndex = '10000';
    video.style.opacity = '1';
    video.style.filter = 'none';
  }

  // Désélection vidéo, reprise animation
  function deselectVideo() {
    floatingVideos.forEach(({video}) => {
      video.style.position = 'absolute';
      video.style.transform = 'none';
      video.style.zIndex = '';
      video.style.opacity = '0.6';
      video.style.filter = 'blur(1.8px)';
      video.classList.remove('selected');
    });
  }

  // Créer les vidéos initiales (maxVideosOnScreen)
  for(let i=0; i < maxVideosOnScreen; i++) {
    createFloatingVideo(videosSrc[i % videosSrc.length]);
  }

  let lastTimestamp = null;
  let selected = false;

  // Animation JS pour contrôle précis (évite superposition horizontale)
  function animate(timestamp) {
    if (!lastTimestamp) lastTimestamp = timestamp;
    const delta = (timestamp - lastTimestamp) / 1000; // en secondes
    lastTimestamp = timestamp;

    if (!selected) {
      // On déplace les vidéos si aucune sélection
      floatingVideos.forEach(obj => {
        obj.x -= obj.speed * delta;

        // Si complètement hors écran à gauche, remettre à droite (loop)
        if (obj.x + obj.width < -100) {
          obj.x = containerWidth + Math.random() * 300;
          // Reposition verticale pour éviter superpositions sur loop
          const newTop = findFreeTop(obj.height);
          obj.top = newTop;
          obj.video.style.top = `${newTop}px`;
        }
        obj.video.style.left = `${obj.x}px`;
      });
    }

    requestAnimationFrame(animate);
  }

  // Démarrer animation
  animate();

  // Gestion sélection / désélection vidéo par clic
  document.body.addEventListener('click', e => {
    if (e.target.classList.contains('floating-video')) {
      if (e.target.classList.contains('selected')) {
        selected = false;
        deselectVideo();
      } else {
        selected = true;
        selectVideo(e.target);
      }
    } else if (selected) {
      // Si clic hors vidéo sélectionnée, désélectionner
      selected = false;
      deselectVideo();
    }
  });

  // Met à jour la taille des conteneurs si resize
  window.addEventListener('resize', () => {
    usedTops.length = 0;
  });
</script>

</body>
</html>
